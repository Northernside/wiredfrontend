<!DOCTYPE html>
<html>

<head>
    <title>Wired</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/style.css" rel="stylesheet">

    <!--utils.html-->
</head>

<body class="bg-[#101010] text-white">
    <!--cookie-checker.html-->
    <div class="flex flex-row gap-2">
        <!--navbar.html-->
        <!--load-user-data.html-->

        <div class="ml-4 mt-4 flex flex-col">
            <p class="text-2xl font-bold mb-4">
                Routes Management
            </p>

            <div id="routes" class="flex flex-row gap-2 flex-wrap">
                <p class="text-lg font-semibold" id="routes-loading">Loading...</p>
            </div>
        </div>
    </div>

    <script>
        (async () => {
            const routesResponse = await authFetch("https://master.wired.rip/api/routes", {}).then(async (res) => await res.json());
            const routesDiv = document.getElementById("routes");

            for (const route of routesResponse.routes) {
                const routeDiv = document.createElement("div");
                routeDiv.classList.add("flex", "flex-col");

                const routeHeader = document.createElement("div");
                routeHeader.classList.add("bg-[#151515]", "border", "border-[#2C2C2C]", "rounded-t-lg", "p-2", "flex", "flex-row", "gap-2", "w-[350px]", "h-[50px]", "flex", "flex-row", "items-center", "justify-between");

                const routeName = document.createElement("p");
                routeName.classList.add("text-md", "font-semibold");
                routeName.innerText = route.proxy_domain;
                routeHeader.appendChild(routeName);

                const trashbin = document.createElement("button");
                trashbin.classList.add("hover:bg-[#202020]", "rounded-lg", "p-2", "group", "transition-all", "duration-300");

                const trashbinSvg = `
                <svg class="h-6 w-6 group-hover:fill-red-500 fill-neutral-500 transition-all duration-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path></svg>
                `;

                trashbin.innerHTML = trashbinSvg;
                routeHeader.appendChild(trashbin);

                routeDiv.appendChild(routeHeader);

                const routeBody = document.createElement("div");
                routeBody.classList.add("bg-[#151515]", "border", "border-t-0", "border-[#2C2C2C]", "rounded-b-lg", "p-2", "flex", "flex-row", "gap-2", "w-[350px]", "h-[80px]", "flex", "flex-row", "items-center");

                const routeBodyLeft = document.createElement("div");
                routeBodyLeft.classList.add("flex", "flex-row", "gap-2", "w-full");

                const routeBodyLeftHost = document.createElement("div");
                routeBodyLeftHost.classList.add("w-full");

                const routeBodyLeftHostLabel = document.createElement("p");
                routeBodyLeftHostLabel.classList.add("text-sm", "font-regular", "text-neutral-400");
                routeBodyLeftHostLabel.innerText = "Host";
                routeBodyLeftHost.appendChild(routeBodyLeftHostLabel);

                const routeBodyLeftHostValue = document.createElement("p");
                routeBodyLeftHostValue.classList.add("text-md", "font-medium", "bg-[#202020]", "border", "border-[#303030]", "rounded-lg", "px-2", "py-1", "w-full");
                routeBodyLeftHostValue.innerText = route.server_host;
                routeBodyLeftHost.appendChild(routeBodyLeftHostValue);

                routeBodyLeft.appendChild(routeBodyLeftHost);

                const routeBodyLeftPort = document.createElement("div");
                routeBodyLeftPort.classList.add("w-max");

                const routeBodyLeftPortLabel = document.createElement("p");
                routeBodyLeftPortLabel.classList.add("text-sm", "font-regular", "text-neutral-400");
                routeBodyLeftPortLabel.innerText = "Port";
                routeBodyLeftPort.appendChild(routeBodyLeftPortLabel);

                const routeBodyLeftPortValue = document.createElement("p");
                routeBodyLeftPortValue.classList.add("text-md", "font-medium", "bg-[#202020]", "border", "border-[#303030]", "rounded-lg", "px-2", "py-1");
                routeBodyLeftPortValue.innerText = route.server_port;
                routeBodyLeftPort.appendChild(routeBodyLeftPortValue);

                routeBodyLeft.appendChild(routeBodyLeftPort);
                routeBody.appendChild(routeBodyLeft);

                routeDiv.appendChild(routeBody);

                routesDiv.appendChild(routeDiv);

                trashbin.addEventListener("click", async () => {
                    const deleteRouteResponse = await authFetch(`https://master.wired.rip/api/routes/remove?route_id=${route.route_id}`, { method: "DELETE" });

                    if (deleteRouteResponse.status === 200) {
                        alert("Route deleted successfully!");
                        location.reload();
                    } else {
                        alert("Failed to delete route!");
                    }
                });
            }

            const createNewRouteDiv = document.createElement("div");
            createNewRouteDiv.classList.add("border-2", "border-[#2C2C2C]", "border-dashed", "rounded-lg", "p-2", "flex", "flex-row", "gap-2", "w-[350px]", "h-[130px]", "flex", "flex-row", "items-center", "justify-center", "cursor-pointer");
            createNewRouteDiv.id = "create-route";
            createNewRouteDiv.innerHTML = "<p>Create new route</p>";
            routesDiv.appendChild(createNewRouteDiv);

            document.getElementById("routes-loading").remove();

            const createRouteButton = document.getElementById("create-route");
            createRouteButton.addEventListener("click", async () => {
                const serverHost = prompt("Server Host");
                const serverPort = prompt("Server Port");
                const proxyPort = 25565;
                const proxyDomain = prompt("Proxy Domain");

                const createRouteResponse = await authFetch(`https://master.wired.rip/api/routes/add?server_host=${serverHost}&server_port=${serverPort}&proxy_port=${proxyPort}&proxy_domain=${proxyDomain}`, {});

                if (createRouteResponse.status === 200) {
                    alert("Route created successfully!");
                    location.reload();
                } else {
                    alert("Failed to create route!");
                }
            });
        })();
    </script>
</body>

</html>